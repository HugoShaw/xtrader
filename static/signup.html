<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>xtrader - Sign Up</title>
    <style>
      :root {
        --bg: #0b1020;
        --card: #111831;
        --text: #e8ecf3;
        --muted: #9aa6c2;
        --accent: #4f7cff;
        --accent-2: #3a63d9;
        --danger: #ff6b6b;
        --ok: #36d399;
        --border: #1d2747;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1200px 600px at 10% -10%, #1a2450 0%, var(--bg) 55%);
        color: var(--text);
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 24px;
      }
      .card {
        width: 100%;
        max-width: 420px;
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0));
        background-color: var(--card);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 24px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
      }
      h1 {
        margin: 0 0 8px;
        font-size: 22px;
      }
      p.sub {
        margin: 0 0 20px;
        color: var(--muted);
        font-size: 14px;
      }
      label {
        display: block;
        font-size: 13px;
        color: var(--muted);
        margin: 10px 0 6px;
      }
      input {
        width: 100%;
        padding: 12px 12px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: #0d1430;
        color: var(--text);
        outline: none;
      }
      input:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(79,124,255,0.25);
      }
      button {
        margin-top: 16px;
        width: 100%;
        padding: 12px 14px;
        border-radius: 10px;
        border: none;
        background: var(--accent);
        color: white;
        font-weight: 600;
        cursor: pointer;
      }
      button:hover { background: var(--accent-2); }
      .row {
        margin-top: 14px;
        font-size: 14px;
        color: var(--muted);
        text-align: center;
      }
      a { color: var(--accent); text-decoration: none; }
      a:hover { text-decoration: underline; }
      .msg {
        margin-top: 12px;
        padding: 10px 12px;
        border-radius: 10px;
        font-size: 14px;
        display: none;
        border: 1px solid transparent;
      }
      .msg.error {
        display: block;
        color: #ffd7d7;
        background: rgba(255, 107, 107, 0.12);
        border-color: rgba(255, 107, 107, 0.35);
      }
      .msg.ok {
        display: block;
        color: #d7ffef;
        background: rgba(54, 211, 153, 0.12);
        border-color: rgba(54, 211, 153, 0.35);
      }
      .hint {
        margin-top: 6px;
        font-size: 12px;
        color: var(--muted);
      }
      code {
        padding: 1px 6px;
        border-radius: 6px;
        background: rgba(255,255,255,0.06);
        border: 1px solid var(--border);
      }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>Create Account</h1>
      <p class="sub">Sign up to access protected xtrader routes.</p>

      <form id="signup-form">
        <label for="username">Username</label>
        <input id="username" name="username" autocomplete="username" required />
        <div class="hint">3-32 chars: letters, digits, underscore.</div>

        <label for="password">Password</label>
        <input id="password" name="password" type="password" autocomplete="new-password" required />
        <div class="hint">At least 8 characters.</div>

        <label for="password-confirm">Confirm Password</label>
        <input
          id="password-confirm"
          name="password_confirm"
          type="password"
          autocomplete="new-password"
          required
        />

        <button id="submit-btn" type="submit">Sign Up</button>
        <div id="message" class="msg" role="status" aria-live="polite"></div>
      </form>

      <div class="row">
        Already have an account?
        <a href="/login">Log in</a>
      </div>

      <div class="row" style="margin-top:8px">
        API endpoints: <code>/auth/signup</code>, <code>/auth/login</code>
      </div>
    </main>

    <script>
      const form = document.getElementById("signup-form");
      const msg = document.getElementById("message");
      const btn = document.getElementById("submit-btn");

      function showMessage(text, kind) {
        msg.textContent = text;
        msg.className = `msg ${kind}`;
      }

      function clearMessage() {
        msg.textContent = "";
        msg.className = "msg";
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        clearMessage();

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;
        const passwordConfirm = document.getElementById("password-confirm").value;

        if (!username) {
          showMessage("Username is required.", "error");
          return;
        }
        if (password.length < 8) {
          showMessage("Password must be at least 8 characters.", "error");
          return;
        }
        if (password !== passwordConfirm) {
          showMessage("Passwords do not match.", "error");
          return;
        }

        btn.disabled = true;
        btn.textContent = "Creating...";

        try {
          const res = await fetch("/auth/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              username,
              password,
              password_confirm: passwordConfirm,
            }),
          });

          const data = await res.json().catch(() => ({}));
          if (!res.ok) {
            const detail = data && data.detail ? data.detail : `Signup failed (${res.status})`;
            showMessage(detail, "error");
            return;
          }

          showMessage("Account created. Redirecting to login...", "ok");
          setTimeout(() => {
            window.location.href = "/login";
          }, 700);
        } catch (err) {
          showMessage(`Network error: ${err}`, "error");
        } finally {
          btn.disabled = false;
          btn.textContent = "Sign Up";
        }
      });
    </script>
  </body>
</html>

